import { useState, useRef, useEffect } from "react";
import { apiClient } from "../../../config/axiosConfig";

const SelectSupplierPayMethod = ({ defaultSupplierPay, onSelectSupplierPayMethod }) => {
    const [supplierPayMethodSuggestions, setSupplierPayMethodSuggestions] = useState([]);
    const [searchValue, setSearchValue] = useState(defaultSupplierPay || ""); // Initialize with default value
    const debounceFetch = useRef(null);

    useEffect(() => {
        setSearchValue(defaultSupplierPay || ""); // Keep in sync with defaultPayment
    }, [defaultSupplierPay]);

    const fetchSuppliersPayMethodByName = async (name) => {
        if (!name.trim()) {
            setSupplierPayMethodSuggestions([]);
            return;
        }
        try {
            const response = await apiClient.post("supplier-payment-methods/name", { name });
            const data = Array.isArray(response.data.response) ? response.data.response : [];
            setSupplierPayMethodSuggestions(data);
        } catch (error) {
            console.error("Error al buscar métodos de pago:", error);
            setSupplierPayMethodSuggestions([]);
        }
    };

    const handleSearchChange = (e) => {
        const name = e.target.value;
        setSearchValue(name);
        if (debounceFetch.current) {
            clearTimeout(debounceFetch.current);
        }
        debounceFetch.current = setTimeout(() => {
            fetchSuppliersPayMethodByName(name);
        }, 500);
    }

    const handleSupplierPayMethodSelect = (supplierPayMethod) => {
        setSearchValue(supplierPayMethod.supplier_payment_description);
        setSupplierPayMethodSuggestions([]);
        onSelectSupplierPayMethod(supplierPayMethod);
    };

    return (
        <div>
            <input
                type="text"
                placeholder="Buscar Condición de venta"
                value={searchValue}
                onChange={handleSearchChange}
            />
            <ul>
                {supplierPayMethodSuggestions.map((supplierPayMethod) => (
                    <li
                        key={supplierPayMethod._id}
                        onClick={() => handleSupplierPayMethodSelect(supplierPayMethod)}
                    >
                        {supplierPayMethod.supplier_payment_description}
                    </li>
                ))}
            </ul>
        </div>
    );
}
export default SelectSupplierPayMethod;